webpackJsonp([117],{1830:function(n,e,t){"use strict";function l(n){return c._42(0,[(n()(),c._16(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.openCourseFilter(t)&&l}return l},H.b,H.a)),c._15(1,1097728,[[3,4]],0,U.a,[[8,""],W.a,c.p,c.K],null,null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._15(5,147456,null,0,Y.a,[W.a,c.p,c.K],{name:[0,"name"]},null),(n()(),c._40(-1,0,["\n            "]))],function(n,e){n(e,5,0,"funnel")},function(n,e){n(e,0,0,c._41(e,0,0,c._29(e,2).transform("core.courses.filter")));n(e,4,0,c._29(e,5)._hidden)})}function i(n){return c._42(0,[(n()(),c._16(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,z.b,z.a)),c._15(1,49152,null,0,B.a,[],{message:[0,"message"],icon:[1,"icon"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "]))],function(n,e){n(e,1,0,c._41(e,1,0,c._29(e,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return c._42(0,[(n()(),c._16(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,e){n(e,0,0,c._19(1,"",e.parent.context.$implicit.moduleIcon,""))})}function o(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"core-icon",[["item-start",""]],null,null,null,G.b,G.a)),c._15(1,245760,null,0,J.a,[c.p],{name:[0,"name"]},null)],function(n,e){n(e,1,0,e.parent.context.$implicit.icon)},null)}function u(n){return c._42(0,[(n()(),c._16(0,0,null,null,20,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.gotoEvent(n.context.$implicit.id)&&l}return l},q.b,q.a)),c._15(1,1097728,null,3,Q.a,[X.a,W.a,c.p,c.K,[2,Z.a]],null,null),c._37(335544320,4,{contentLabel:0}),c._37(603979776,5,{_buttons:1}),c._37(603979776,6,{_icons:1}),c._15(5,16384,null,0,nn.a,[],null,null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,a)),c._15(8,16384,null,0,en.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,o)),c._15(11,16384,null,0,en.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(13,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),c._16(14,0,null,null,1,"core-format-text",[],null,null,null,null,null)),c._15(15,540672,null,0,tn.a,[c.p,E.a,m.a,ln.a,V.a,an.a,b.a,on.a,un.a,rn.a,T.a,sn.a,[2,cn.a],[2,dn.a],[2,x.a],_n.a,I.a],{text:[0,"text"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(17,0,null,2,2,"p",[],null,null,null,null,null)),(n()(),c._40(18,null,["",""])),c._34(19,1),(n()(),c._40(-1,2,["\n                "]))],function(n,e){n(e,8,0,e.context.$implicit.moduleIcon);n(e,11,0,e.context.$implicit.icon&&!e.context.$implicit.moduleIcon);n(e,15,0,e.context.$implicit.name)},function(n,e){n(e,0,0,e.context.$implicit.name,e.context.$implicit.id==e.component.eventId);n(e,18,0,c._41(e,18,0,n(e,19,0,c._29(e.parent.parent,0),e.context.$implicit.timestart)))})}function r(n){return c._42(0,[(n()(),c._16(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),c._15(1,16384,null,0,fn.a,[W.a,c.p,c.K,an.a,hn.l,pn.a],null,null),(n()(),c._40(-1,null,["\n                "])),(n()(),c._11(16777216,null,null,1,null,u)),c._15(4,802816,null,0,en.j,[c.W,c.T,c.v],{ngForOf:[0,"ngForOf"]},null),(n()(),c._40(-1,null,["\n            "]))],function(n,e){n(e,4,0,e.component.filteredEvents)},null)}function s(n){return c._42(0,[c._32(0,vn.a,[un.a]),c._37(402653184,1,{content:0}),c._37(402653184,2,{splitviewCtrl:0}),(n()(),c._16(3,0,null,null,28,"ion-header",[],null,null,null,null,null)),c._15(4,16384,null,0,gn.a,[W.a,c.p,c.K,[2,mn.a]],null,null),(n()(),c._40(-1,null,["\n    "])),(n()(),c._16(6,0,null,null,24,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,bn.b,bn.a)),c._15(7,49152,null,0,En.a,[yn.a,[2,mn.a],[2,cn.a],W.a,c.p,c.K],null,null),c._15(8,212992,null,0,Cn.a,[En.a,an.a,V.a,I.a],null,null),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(10,0,null,3,3,"ion-title",[],null,null,null,In.b,In.a)),c._15(11,49152,null,0,Tn.a,[W.a,c.p,c.K,[2,xn.a],[2,En.a]],null,null),(n()(),c._40(12,0,["",""])),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(15,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),c._15(16,16384,null,1,Ln.a,[W.a,c.p,c.K,[2,xn.a],[2,En.a]],null,null),c._37(603979776,3,{_buttons:1}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._11(16777216,null,null,1,null,l)),c._15(20,16384,null,0,en.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(22,0,null,null,6,"core-context-menu",[],null,null,null,Dn.b,Dn.a)),c._15(23,245760,null,0,Pn.a,[V.a,An.a,c.p,m.a,[2,Mn.a]],null,null),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(25,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,e,t){var l=!0;if("action"===e){l=!1!==n.component.openSettings()&&l}return l},kn.b,kn.a)),c._15(26,770048,null,0,Rn.a,[Pn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "])),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,3,["\n    "])),(n()(),c._40(-1,null,["\n"])),(n()(),c._40(-1,null,["\n"])),(n()(),c._16(33,0,null,null,27,"core-split-view",[],null,null,null,Fn.b,Fn.a)),c._15(34,245760,[[2,4]],0,x.a,[[2,cn.a],c.p,$n.a,an.a,V.a],null,null),(n()(),c._40(-1,0,["\n    "])),(n()(),c._16(36,0,null,0,23,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Kn.b,Kn.a)),c._15(37,4374528,[[1,4]],0,dn.a,[W.a,an.a,pn.a,c.p,c.K,yn.a,wn.a,c.D,[2,mn.a],[2,cn.a]],null,null),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(39,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,e,t){var l=!0;if("ionRefresh"===e){l=!1!==n.component.refreshEvents(t)&&l}return l},null,null)),c._15(40,212992,null,0,Nn.a,[an.a,dn.a,c.D,hn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(42,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,On.b,On.a)),c._15(43,114688,null,0,Sn.a,[Nn.a,W.a],{pullingText:[0,"pullingText"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(47,0,null,1,11,"core-loading",[],null,null,null,Hn.b,Hn.a)),c._15(48,638976,null,0,Un.a,[V.a,c.p,I.a,b.a],{hideUntil:[0,"hideUntil"]},null),(n()(),c._40(-1,0,["\n            "])),(n()(),c._11(16777216,null,0,1,null,i)),c._15(51,16384,null,0,en.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._11(16777216,null,0,1,null,r)),c._15(54,16384,null,0,en.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._16(56,0,null,0,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,e,t){var l=!0;if("action"===e){l=!1!==n.component.loadMoreEvents(t)&&l}return l},Wn.b,Wn.a)),c._15(57,49152,null,0,jn.a,[],{enabled:[0,"enabled"],error:[1,"error"]},{action:"action"}),(n()(),c._40(-1,0,["\n        "])),(n()(),c._40(-1,1,["\n    "])),(n()(),c._40(-1,0,["\n"]))],function(n,e){var t=e.component;n(e,8,0);n(e,20,0,t.courses&&t.courses.length),n(e,23,0);n(e,26,0,c._41(e,26,0,c._29(e,27).transform("core.settings.settings")),"cog",600,!t.notificationsEnabled),n(e,34,0);n(e,40,0,t.eventsLoaded);n(e,43,0,c._19(1,"",c._41(e,43,0,c._29(e,44).transform("core.pulltorefresh")),""));n(e,48,0,t.eventsLoaded);n(e,51,0,!t.filteredEvents||!t.filteredEvents.length);n(e,54,0,t.filteredEvents&&t.filteredEvents.length);n(e,57,0,t.canLoadMore,t.loadMoreError)},function(n,e){n(e,6,0,c._29(e,7)._hidden,c._29(e,7)._sbPadding);n(e,12,0,c._41(e,12,0,c._29(e,13).transform("addon.calendar.calendarevents")));n(e,36,0,c._29(e,37).statusbarPadding,c._29(e,37)._hasRefresher);n(e,39,0,"inactive"!==c._29(e,40).state,c._29(e,40)._top);n(e,42,0,c._29(e,43).r.state)})}Object.defineProperty(e,"__esModule",{value:!0});var c=t(1),d=(t(0),t(9),t(4)),_=t(28),f=t(29),h=t(108),p=t(339),v=t(674),g=t(51),m=t(5),b=t(3),E=t(2),y=t(143),C=t(707),I=t(13),T=t(11),x=t(34),L=function(){function n(n,e,t,l,i,a,o,u,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=e,this.domUtils=l,this.coursesProvider=i,this.utils=a,this.calendarHelper=o,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.loadMoreError=!1,this.filter={course:this.allCourses},this.siteHomeId=u.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(p.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){e.scheduleEventsNotifications(f.events)},u.getCurrentSiteId())),this.eventId=t.get("eventId")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var e=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(t){return t.unshift(e.allCourses),e.courses=t,e.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var e=this;return void 0===n&&(n=!1),this.loadMoreError=!1,this.calendarProvider.getEventsList(this.daysLoaded,p.a.DAYS_INTERVAL).then(function(t){if(e.daysLoaded+=p.a.DAYS_INTERVAL,0===t.length){if(e.emptyEventsTimes++,!(e.emptyEventsTimes>5))return e.fetchEvents();e.canLoadMore=!1,n&&(e.events=[],e.filteredEvents=[])}else t.sort(function(n,e){return n.timestart-e.timestart}),t.forEach(e.calendarHelper.formatEventData.bind(e.calendarHelper)),e.getCategories=e.shouldLoadCategories(t),e.events=n?t:e.utils.mergeArraysWithoutDuplicates(e.events,t,"id"),e.filteredEvents=e.getFilteredEvents(),e.canLoadMore=!0,e.calendarProvider.scheduleEventsNotifications(e.events);e.content.resize()}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),e.loadMoreError=!0}).then(function(){if(e.getCategories)return e.getCategories=!1,e.loadCategories()})},n.prototype.loadMoreEvents=function(n){return this.fetchEvents().finally(function(){n&&n()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var e=this.categories[this.filter.course.category];e&&e.parent;){if(n.categoryid==e.parent)return!0;e=this.categories[e.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(e){n.categoriesRetrieved=!0,n.categories={},e.forEach(function(e){n.categories[e.id]=e})}).catch(function(){})},n.prototype.refreshEvents=function(n){var e=this,t=[];t.push(this.calendarProvider.invalidateEventsList()),this.categoriesRetrieved&&(t.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(t).finally(function(){e.fetchData(!0).finally(function(){n.complete()})})},n.prototype.openCourseFilter=function(n){var e=this,t=this.popoverCtrl.create(C.a,{courses:this.courses,courseId:this.filter.course.id});t.onDidDismiss(function(n){n&&(e.filter.course=n,e.domUtils.scrollToTop(e.content),e.filteredEvents=e.getFilteredEvents())}),t.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},n}(),D=function(){return function(){}}(),P=t(1344),A=t(1345),M=t(1346),k=t(1347),R=t(1348),F=t(1349),$=t(1350),K=t(1351),w=t(1352),N=t(1355),O=t(1356),S=t(1357),H=t(45),U=t(42),W=t(7),j=t(25),V=t(18),Y=t(46),z=t(120),B=t(111),G=t(134),J=t(121),q=t(30),Q=t(21),X=t(20),Z=t(27),nn=t(32),en=t(8),tn=t(40),ln=t(10),an=t(15),on=t(26),un=t(6),rn=t(17),sn=t(19),cn=t(22),dn=t(24),_n=t(37),fn=t(77),hn=t(38),pn=t(31),vn=t(667),gn=t(434),mn=t(36),bn=t(1353),En=t(200),yn=t(33),Cn=t(662),In=t(1354),Tn=t(335),xn=t(247),Ln=t(435),Dn=t(88),Pn=t(73),An=t(63),Mn=t(72),kn=t(89),Rn=t(80),Fn=t(436),$n=t(67),Kn=t(184),wn=t(109),Nn=t(146),On=t(201),Sn=t(158),Hn=t(49),Un=t(48),Wn=t(440),jn=t(277),Vn=t(61),Yn=c._14({encapsulation:2,styles:[],data:{}}),zn=c._12("page-addon-calendar-list",L,function(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,s,Yn)),c._15(1,180224,null,0,L,[V.a,p.a,Vn.a,m.a,g.a,b.a,v.a,E.a,y.a,An.a,I.a,cn.a,T.a],null,null)],null,null)},{},{},[]),Bn=t(23),Gn=t(331),Jn=t(332),qn=t(334),Qn=t(333),Xn=t(433),Zn=t(661),ne=t(248);t.d(e,"AddonCalendarListPageModuleNgFactory",function(){return ee});var ee=c._13(D,[],function(n){return c._25([c._26(512,c.n,c._6,[[8,[P.a,A.a,M.a,k.a,R.a,F.a,$.a,K.a,w.a,N.a,O.a,S.a,zn]],[3,c.n],c.B]),c._26(4608,en.m,en.l,[c.x,[2,en.v]]),c._26(4608,Bn.x,Bn.x,[]),c._26(4608,Bn.d,Bn.d,[]),c._26(4608,Gn.b,Gn.a,[]),c._26(4608,Jn.a,Jn.b,[]),c._26(4608,qn.b,qn.a,[]),c._26(4608,Qn.b,Qn.a,[]),c._26(4608,V.a,V.a,[Xn.a,Gn.b,Jn.a,qn.b,Qn.b,V.b,V.c]),c._26(512,en.b,en.b,[]),c._26(512,Bn.v,Bn.v,[]),c._26(512,Bn.i,Bn.i,[]),c._26(512,Bn.s,Bn.s,[]),c._26(512,Zn.a,Zn.a,[]),c._26(512,d.a,d.a,[]),c._26(512,f.a,f.a,[]),c._26(512,h.a,h.a,[]),c._26(512,_.a,_.a,[]),c._26(512,Zn.b,Zn.b,[]),c._26(512,D,D,[]),c._26(256,V.c,void 0,[]),c._26(256,V.b,void 0,[]),c._26(256,ne.a,L,[])])})}});
webpackJsonp([114],{1765:function(n,t,e){"use strict";function l(n){return c._42(0,[(n()(),c._16(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,t,e){var l=!0;if("click"===t){l=!1!==n.component.openCourseFilter(e)&&l}return l},H.b,H.a)),c._15(1,1097728,[[3,4]],0,U.a,[[8,""],W.a,c.p,c.K],null,null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._15(5,147456,null,0,Y.a,[W.a,c.p,c.K],{name:[0,"name"]},null),(n()(),c._40(-1,0,["\n            "]))],function(n,t){n(t,5,0,"funnel")},function(n,t){n(t,0,0,c._41(t,0,0,c._29(t,2).transform("core.courses.filter")));n(t,4,0,c._29(t,5)._hidden)})}function i(n){return c._42(0,[(n()(),c._16(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,z.b,z.a)),c._15(1,49152,null,0,B.a,[],{message:[0,"message"],icon:[1,"icon"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "]))],function(n,t){n(t,1,0,c._41(t,1,0,c._29(t,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return c._42(0,[(n()(),c._16(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,t){n(t,0,0,c._19(1,"",t.parent.context.$implicit.moduleIcon,""))})}function o(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"core-icon",[["item-start",""]],null,null,null,G.b,G.a)),c._15(1,114688,null,0,J.a,[c.p],{name:[0,"name"]},null)],function(n,t){n(t,1,0,t.parent.context.$implicit.icon)},null)}function u(n){return c._42(0,[(n()(),c._16(0,0,null,null,20,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,t,e){var l=!0;if("click"===t){l=!1!==n.component.gotoEvent(n.context.$implicit.id)&&l}return l},q.b,q.a)),c._15(1,1097728,null,3,Q.a,[X.a,W.a,c.p,c.K,[2,Z.a]],null,null),c._37(335544320,4,{contentLabel:0}),c._37(603979776,5,{_buttons:1}),c._37(603979776,6,{_icons:1}),c._15(5,16384,null,0,nn.a,[],null,null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,a)),c._15(8,16384,null,0,tn.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,o)),c._15(11,16384,null,0,tn.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(13,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),c._16(14,0,null,null,1,"core-format-text",[],null,null,null,null,null)),c._15(15,540672,null,0,en.a,[c.p,y.a,m.a,ln.a,V.a,an.a,b.a,on.a,un.a,rn.a,L.a,sn.a,[2,cn.a],[2,dn.a],[2,T.a],_n.a,I.a],{text:[0,"text"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(17,0,null,2,2,"p",[],null,null,null,null,null)),(n()(),c._40(18,null,["",""])),c._34(19,1),(n()(),c._40(-1,2,["\n                "]))],function(n,t){n(t,8,0,t.context.$implicit.moduleIcon);n(t,11,0,t.context.$implicit.icon&&!t.context.$implicit.moduleIcon);n(t,15,0,t.context.$implicit.name)},function(n,t){n(t,0,0,t.context.$implicit.name,t.context.$implicit.id==t.component.eventId);n(t,18,0,c._41(t,18,0,n(t,19,0,c._29(t.parent.parent,0),t.context.$implicit.timestart)))})}function r(n){return c._42(0,[(n()(),c._16(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),c._15(1,16384,null,0,fn.a,[W.a,c.p,c.K,an.a,hn.l,pn.a],null,null),(n()(),c._40(-1,null,["\n                "])),(n()(),c._11(16777216,null,null,1,null,u)),c._15(4,802816,null,0,tn.j,[c.W,c.T,c.v],{ngForOf:[0,"ngForOf"]},null),(n()(),c._40(-1,null,["\n            "]))],function(n,t){n(t,4,0,t.component.filteredEvents)},null)}function s(n){return c._42(0,[c._32(0,vn.a,[un.a]),c._37(402653184,1,{content:0}),c._37(402653184,2,{splitviewCtrl:0}),(n()(),c._16(3,0,null,null,28,"ion-header",[],null,null,null,null,null)),c._15(4,16384,null,0,gn.a,[W.a,c.p,c.K,[2,mn.a]],null,null),(n()(),c._40(-1,null,["\n    "])),(n()(),c._16(6,0,null,null,24,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,bn.b,bn.a)),c._15(7,49152,null,0,yn.a,[En.a,[2,mn.a],[2,cn.a],W.a,c.p,c.K],null,null),c._15(8,212992,null,0,Cn.a,[yn.a,an.a,V.a,I.a],null,null),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(10,0,null,3,3,"ion-title",[],null,null,null,In.b,In.a)),c._15(11,49152,null,0,Ln.a,[W.a,c.p,c.K,[2,Tn.a],[2,yn.a]],null,null),(n()(),c._40(12,0,["",""])),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(15,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),c._15(16,16384,null,1,xn.a,[W.a,c.p,c.K,[2,Tn.a],[2,yn.a]],null,null),c._37(603979776,3,{_buttons:1}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._11(16777216,null,null,1,null,l)),c._15(20,16384,null,0,tn.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(22,0,null,null,6,"core-context-menu",[],null,null,null,Dn.b,Dn.a)),c._15(23,245760,null,0,Pn.a,[V.a,An.a,c.p,m.a,[2,kn.a]],null,null),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(25,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,t,e){var l=!0;if("action"===t){l=!1!==n.component.openSettings()&&l}return l},Rn.b,Rn.a)),c._15(26,770048,null,0,Mn.a,[Pn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "])),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,3,["\n    "])),(n()(),c._40(-1,null,["\n"])),(n()(),c._40(-1,null,["\n"])),(n()(),c._16(33,0,null,null,27,"core-split-view",[],null,null,null,Fn.b,Fn.a)),c._15(34,245760,[[2,4]],0,T.a,[[2,cn.a],c.p,$n.a,an.a,V.a],null,null),(n()(),c._40(-1,0,["\n    "])),(n()(),c._16(36,0,null,0,23,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Kn.b,Kn.a)),c._15(37,4374528,[[1,4]],0,dn.a,[W.a,an.a,pn.a,c.p,c.K,En.a,wn.a,c.D,[2,mn.a],[2,cn.a]],null,null),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(39,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,t,e){var l=!0;if("ionRefresh"===t){l=!1!==n.component.refreshEvents(e)&&l}return l},null,null)),c._15(40,212992,null,0,Nn.a,[an.a,dn.a,c.D,hn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(42,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,On.b,On.a)),c._15(43,114688,null,0,Sn.a,[Nn.a,W.a],{pullingText:[0,"pullingText"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(47,0,null,1,11,"core-loading",[],null,null,null,Hn.b,Hn.a)),c._15(48,638976,null,0,Un.a,[V.a,c.p,I.a,b.a],{hideUntil:[0,"hideUntil"]},null),(n()(),c._40(-1,0,["\n            "])),(n()(),c._11(16777216,null,0,1,null,i)),c._15(51,16384,null,0,tn.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._11(16777216,null,0,1,null,r)),c._15(54,16384,null,0,tn.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._16(56,0,null,0,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,t,e){var l=!0;if("action"===t){l=!1!==n.component.loadMoreEvents(e)&&l}return l},Wn.b,Wn.a)),c._15(57,49152,null,0,jn.a,[],{enabled:[0,"enabled"]},{action:"action"}),(n()(),c._40(-1,0,["\n        "])),(n()(),c._40(-1,1,["\n    "])),(n()(),c._40(-1,0,["\n"]))],function(n,t){var e=t.component;n(t,8,0);n(t,20,0,e.courses&&e.courses.length),n(t,23,0);n(t,26,0,c._41(t,26,0,c._29(t,27).transform("core.settings.settings")),"cog",600,!e.notificationsEnabled),n(t,34,0);n(t,40,0,e.eventsLoaded);n(t,43,0,c._19(1,"",c._41(t,43,0,c._29(t,44).transform("core.pulltorefresh")),""));n(t,48,0,e.eventsLoaded);n(t,51,0,!e.filteredEvents||!e.filteredEvents.length);n(t,54,0,e.filteredEvents&&e.filteredEvents.length);n(t,57,0,e.canLoadMore)},function(n,t){n(t,6,0,c._29(t,7)._hidden,c._29(t,7)._sbPadding);n(t,12,0,c._41(t,12,0,c._29(t,13).transform("addon.calendar.calendarevents")));n(t,36,0,c._29(t,37).statusbarPadding,c._29(t,37)._hasRefresher);n(t,39,0,"inactive"!==c._29(t,40).state,c._29(t,40)._top);n(t,42,0,c._29(t,43).r.state)})}Object.defineProperty(t,"__esModule",{value:!0});var c=e(1),d=(e(0),e(11),e(6)),_=e(33),f=e(30),h=e(105),p=e(329),v=e(646),g=e(75),m=e(4),b=e(3),y=e(2),E=e(132),C=e(680),I=e(13),L=e(12),T=e(35),x=function(){function n(n,t,e,l,i,a,o,u,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=t,this.domUtils=l,this.coursesProvider=i,this.utils=a,this.calendarHelper=o,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.filter={course:this.allCourses},this.siteHomeId=u.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(p.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){t.scheduleEventsNotifications(f.events)},u.getCurrentSiteId())),this.eventId=e.get("eventId")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var t=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(e){return e.unshift(t.allCourses),t.courses=e,t.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var t=this;return void 0===n&&(n=!1),this.calendarProvider.getEventsList(this.daysLoaded,p.a.DAYS_INTERVAL).then(function(e){if(t.daysLoaded+=p.a.DAYS_INTERVAL,0===e.length){if(t.emptyEventsTimes++,!(t.emptyEventsTimes>5))return t.fetchEvents();t.canLoadMore=!1,n&&(t.events=[],t.filteredEvents=[])}else e.sort(function(n,t){return n.timestart-t.timestart}),e.forEach(t.calendarHelper.formatEventData.bind(t.calendarHelper)),t.getCategories=t.shouldLoadCategories(e),t.events=n?e:t.utils.mergeArraysWithoutDuplicates(t.events,e,"id"),t.filteredEvents=t.getFilteredEvents(),t.canLoadMore=!0,t.calendarProvider.scheduleEventsNotifications(t.events);t.content.resize()}).catch(function(n){t.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),t.canLoadMore=!1}).then(function(){if(t.getCategories)return t.getCategories=!1,t.loadCategories()})},n.prototype.loadMoreEvents=function(n){return this.fetchEvents().finally(function(){n&&n()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var t=this.categories[this.filter.course.category];t&&t.parent;){if(n.categoryid==t.parent)return!0;t=this.categories[t.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(t){n.categoriesRetrieved=!0,n.categories={},t.forEach(function(t){n.categories[t.id]=t})}).catch(function(){})},n.prototype.refreshEvents=function(n){var t=this,e=[];e.push(this.calendarProvider.invalidateEventsList(this.courses)),this.categoriesRetrieved&&(e.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(e).finally(function(){t.fetchData(!0).finally(function(){n.complete()})})},n.prototype.openCourseFilter=function(n){var t=this,e=this.popoverCtrl.create(C.a,{courses:this.courses,courseId:this.filter.course.id});e.onDidDismiss(function(n){n&&(t.filter.course=n,t.domUtils.scrollToTop(t.content),t.filteredEvents=t.getFilteredEvents())}),e.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},n}(),D=function(){return function(){}}(),P=e(1277),A=e(1278),k=e(1279),R=e(1280),M=e(1281),F=e(1282),$=e(1283),K=e(1284),w=e(1285),N=e(1288),O=e(1289),S=e(1290),H=e(46),U=e(41),W=e(7),j=e(29),V=e(18),Y=e(42),z=e(164),B=e(135),G=e(195),J=e(165),q=e(34),Q=e(21),X=e(20),Z=e(28),nn=e(31),tn=e(9),en=e(40),ln=e(10),an=e(15),on=e(26),un=e(5),rn=e(17),sn=e(23),cn=e(22),dn=e(24),_n=e(38),fn=e(74),hn=e(37),pn=e(25),vn=e(640),gn=e(421),mn=e(36),bn=e(1286),yn=e(192),En=e(27),Cn=e(635),In=e(1287),Ln=e(325),Tn=e(235),xn=e(422),Dn=e(86),Pn=e(71),An=e(69),kn=e(70),Rn=e(87),Mn=e(79),Fn=e(425),$n=e(64),Kn=e(179),wn=e(101),Nn=e(134),On=e(193),Sn=e(146),Hn=e(55),Un=e(50),Wn=e(432),jn=e(270),Vn=e(60),Yn=c._14({encapsulation:2,styles:[],data:{}}),zn=c._12("page-addon-calendar-list",x,function(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,s,Yn)),c._15(1,180224,null,0,x,[V.a,p.a,Vn.a,m.a,g.a,b.a,v.a,y.a,E.a,An.a,I.a,cn.a,L.a],null,null)],null,null)},{},{},[]),Bn=e(19),Gn=e(321),Jn=e(322),qn=e(324),Qn=e(323),Xn=e(420),Zn=e(634),nt=e(236);e.d(t,"AddonCalendarListPageModuleNgFactory",function(){return tt});var tt=c._13(D,[],function(n){return c._25([c._26(512,c.n,c._6,[[8,[P.a,A.a,k.a,R.a,M.a,F.a,$.a,K.a,w.a,N.a,O.a,S.a,zn]],[3,c.n],c.B]),c._26(4608,tn.m,tn.l,[c.x,[2,tn.v]]),c._26(4608,Bn.x,Bn.x,[]),c._26(4608,Bn.d,Bn.d,[]),c._26(4608,Gn.b,Gn.a,[]),c._26(4608,Jn.a,Jn.b,[]),c._26(4608,qn.b,qn.a,[]),c._26(4608,Qn.b,Qn.a,[]),c._26(4608,V.a,V.a,[Xn.a,Gn.b,Jn.a,qn.b,Qn.b,V.b,V.c]),c._26(512,tn.b,tn.b,[]),c._26(512,Bn.v,Bn.v,[]),c._26(512,Bn.i,Bn.i,[]),c._26(512,Bn.s,Bn.s,[]),c._26(512,Zn.a,Zn.a,[]),c._26(512,d.a,d.a,[]),c._26(512,f.a,f.a,[]),c._26(512,h.a,h.a,[]),c._26(512,_.a,_.a,[]),c._26(512,Zn.b,Zn.b,[]),c._26(512,D,D,[]),c._26(256,V.c,void 0,[]),c._26(256,V.b,void 0,[]),c._26(256,nt.a,x,[])])})}});